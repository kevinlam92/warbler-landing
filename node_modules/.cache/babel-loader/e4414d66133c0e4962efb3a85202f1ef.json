{"ast":null,"code":"import VideoWorker from 'video-worker';\nimport global from 'global';\nexport default function jarallaxVideo() {\n  let jarallax = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : global.jarallax;\n\n  if ('undefined' === typeof jarallax) {\n    return;\n  }\n\n  const Jarallax = jarallax.constructor; // append video after when block will be visible.\n\n  const defOnScroll = Jarallax.prototype.onScroll;\n\n  Jarallax.prototype.onScroll = function () {\n    const self = this;\n    defOnScroll.apply(self);\n    const isReady = !self.isVideoInserted && self.video && (!self.options.videoLazyLoading || self.isElementInViewport) && !self.options.disableVideo();\n\n    if (isReady) {\n      self.isVideoInserted = true;\n      self.video.getVideo(video => {\n        const $parent = video.parentNode;\n        self.css(video, {\n          position: self.image.position,\n          top: '0px',\n          left: '0px',\n          right: '0px',\n          bottom: '0px',\n          width: '100%',\n          height: '100%',\n          maxWidth: 'none',\n          maxHeight: 'none',\n          pointerEvents: 'none',\n          transformStyle: 'preserve-3d',\n          backfaceVisibility: 'hidden',\n          willChange: 'transform,opacity',\n          margin: 0,\n          zIndex: -1\n        });\n        self.$video = video; // add Poster attribute to self-hosted video\n\n        if ('local' === self.video.type) {\n          if (self.image.src) {\n            self.$video.setAttribute('poster', self.image.src);\n          } else if (self.image.$item && 'IMG' === self.image.$item.tagName && self.image.$item.src) {\n            self.$video.setAttribute('poster', self.image.$item.src);\n          }\n        } // insert video tag\n\n\n        self.image.$container.appendChild(video); // remove parent video element (created by VideoWorker)\n\n        $parent.parentNode.removeChild($parent);\n      });\n    }\n  }; // cover video\n\n\n  const defCoverImage = Jarallax.prototype.coverImage;\n\n  Jarallax.prototype.coverImage = function () {\n    const self = this;\n    const imageData = defCoverImage.apply(self);\n    const node = self.image.$item ? self.image.$item.nodeName : false;\n\n    if (imageData && self.video && node && ('IFRAME' === node || 'VIDEO' === node)) {\n      let h = imageData.image.height;\n      let w = h * self.image.width / self.image.height;\n      let ml = (imageData.container.width - w) / 2;\n      let mt = imageData.image.marginTop;\n\n      if (imageData.container.width > w) {\n        w = imageData.container.width;\n        h = w * self.image.height / self.image.width;\n        ml = 0;\n        mt += (imageData.image.height - h) / 2;\n      } // add video height over than need to hide controls\n\n\n      if ('IFRAME' === node) {\n        h += 400;\n        mt -= 200;\n      }\n\n      self.css(self.$video, {\n        width: `${w}px`,\n        marginLeft: `${ml}px`,\n        height: `${h}px`,\n        marginTop: `${mt}px`\n      });\n    }\n\n    return imageData;\n  }; // init video\n\n\n  const defInitImg = Jarallax.prototype.initImg;\n\n  Jarallax.prototype.initImg = function () {\n    const self = this;\n    const defaultResult = defInitImg.apply(self);\n\n    if (!self.options.videoSrc) {\n      self.options.videoSrc = self.$item.getAttribute('data-jarallax-video') || null;\n    }\n\n    if (self.options.videoSrc) {\n      self.defaultInitImgResult = defaultResult;\n      return true;\n    }\n\n    return defaultResult;\n  };\n\n  const defCanInitParallax = Jarallax.prototype.canInitParallax;\n\n  Jarallax.prototype.canInitParallax = function () {\n    const self = this;\n    let defaultResult = defCanInitParallax.apply(self);\n\n    if (!self.options.videoSrc) {\n      return defaultResult;\n    } // Init video api\n\n\n    const video = new VideoWorker(self.options.videoSrc, {\n      autoplay: true,\n      loop: self.options.videoLoop,\n      showControls: false,\n      accessibilityHidden: true,\n      startTime: self.options.videoStartTime || 0,\n      endTime: self.options.videoEndTime || 0,\n      mute: self.options.videoVolume ? 0 : 1,\n      volume: self.options.videoVolume || 0\n    });\n\n    function resetDefaultImage() {\n      if (self.image.$default_item) {\n        self.image.$item = self.image.$default_item;\n        self.image.$item.style.display = 'block'; // set image width and height\n\n        self.coverImage();\n        self.clipContainer();\n        self.onScroll();\n      }\n    }\n\n    if (video.isValid()) {\n      // Force enable parallax.\n      // When the parallax disabled on mobile devices, we still need to display videos.\n      // https://github.com/nk-o/jarallax/issues/159\n      if (this.options.disableParallax()) {\n        defaultResult = true;\n        self.image.position = 'absolute';\n        self.options.type = 'scroll';\n        self.options.speed = 1;\n      } // if parallax will not be inited, we can add thumbnail on background.\n\n\n      if (!defaultResult) {\n        if (!self.defaultInitImgResult) {\n          video.getImageURL(url => {\n            // save default user styles\n            const curStyle = self.$item.getAttribute('style');\n\n            if (curStyle) {\n              self.$item.setAttribute('data-jarallax-original-styles', curStyle);\n            } // set new background\n\n\n            self.css(self.$item, {\n              'background-image': `url(\"${url}\")`,\n              'background-position': 'center',\n              'background-size': 'cover'\n            });\n          });\n        } // init video\n\n      } else {\n        video.on('ready', () => {\n          if (self.options.videoPlayOnlyVisible) {\n            const oldOnScroll = self.onScroll;\n\n            self.onScroll = function () {\n              oldOnScroll.apply(self);\n\n              if (!self.videoError && (self.options.videoLoop || !self.options.videoLoop && !self.videoEnded)) {\n                if (self.isVisible()) {\n                  video.play();\n                } else {\n                  video.pause();\n                }\n              }\n            };\n          } else {\n            video.play();\n          }\n        });\n        video.on('started', () => {\n          self.image.$default_item = self.image.$item;\n          self.image.$item = self.$video; // set video width and height\n\n          self.image.width = self.video.videoWidth || 1280;\n          self.image.height = self.video.videoHeight || 720;\n          self.coverImage();\n          self.clipContainer();\n          self.onScroll(); // hide image\n\n          if (self.image.$default_item) {\n            self.image.$default_item.style.display = 'none';\n          }\n        });\n        video.on('ended', () => {\n          self.videoEnded = true;\n\n          if (!self.options.videoLoop) {\n            // show default image if Loop disabled.\n            resetDefaultImage();\n          }\n        });\n        video.on('error', () => {\n          self.videoError = true; // show default image if video loading error.\n\n          resetDefaultImage();\n        });\n        self.video = video; // set image if not exists\n\n        if (!self.defaultInitImgResult) {\n          // set empty image on self-hosted video if not defined\n          self.image.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n\n          if ('local' !== video.type) {\n            video.getImageURL(url => {\n              self.image.bgImage = `url(\"${url}\")`;\n              self.init();\n            });\n            return false;\n          }\n        }\n      }\n    }\n\n    return defaultResult;\n  }; // Destroy video parallax\n\n\n  const defDestroy = Jarallax.prototype.destroy;\n\n  Jarallax.prototype.destroy = function () {\n    const self = this;\n\n    if (self.image.$default_item) {\n      self.image.$item = self.image.$default_item;\n      delete self.image.$default_item;\n    }\n\n    defDestroy.apply(self);\n  };\n}","map":{"version":3,"sources":["/Users/kevin/workspace/don-website/node_modules/jarallax/src/jarallax-video.esm.js"],"names":["VideoWorker","global","jarallaxVideo","jarallax","Jarallax","constructor","defOnScroll","prototype","onScroll","self","apply","isReady","isVideoInserted","video","options","videoLazyLoading","isElementInViewport","disableVideo","getVideo","$parent","parentNode","css","position","image","top","left","right","bottom","width","height","maxWidth","maxHeight","pointerEvents","transformStyle","backfaceVisibility","willChange","margin","zIndex","$video","type","src","setAttribute","$item","tagName","$container","appendChild","removeChild","defCoverImage","coverImage","imageData","node","nodeName","h","w","ml","container","mt","marginTop","marginLeft","defInitImg","initImg","defaultResult","videoSrc","getAttribute","defaultInitImgResult","defCanInitParallax","canInitParallax","autoplay","loop","videoLoop","showControls","accessibilityHidden","startTime","videoStartTime","endTime","videoEndTime","mute","videoVolume","volume","resetDefaultImage","$default_item","style","display","clipContainer","isValid","disableParallax","speed","getImageURL","url","curStyle","on","videoPlayOnlyVisible","oldOnScroll","videoError","videoEnded","isVisible","play","pause","videoWidth","videoHeight","bgImage","init","defDestroy","destroy"],"mappings":"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","sourcesContent":["import VideoWorker from 'video-worker';\nimport global from 'global';\n\nexport default function jarallaxVideo( jarallax = global.jarallax ) {\n    if ( 'undefined' === typeof jarallax ) {\n        return;\n    }\n\n    const Jarallax = jarallax.constructor;\n\n    // append video after when block will be visible.\n    const defOnScroll = Jarallax.prototype.onScroll;\n    Jarallax.prototype.onScroll = function() {\n        const self = this;\n\n        defOnScroll.apply( self );\n\n        const isReady = ! self.isVideoInserted\n                        && self.video\n                        && ( ! self.options.videoLazyLoading || self.isElementInViewport )\n                        && ! self.options.disableVideo();\n\n        if ( isReady ) {\n            self.isVideoInserted = true;\n\n            self.video.getVideo( ( video ) => {\n                const $parent = video.parentNode;\n                self.css( video, {\n                    position: self.image.position,\n                    top: '0px',\n                    left: '0px',\n                    right: '0px',\n                    bottom: '0px',\n                    width: '100%',\n                    height: '100%',\n                    maxWidth: 'none',\n                    maxHeight: 'none',\n                    pointerEvents: 'none',\n                    transformStyle: 'preserve-3d',\n                    backfaceVisibility: 'hidden',\n                    willChange: 'transform,opacity',\n                    margin: 0,\n                    zIndex: -1,\n                } );\n                self.$video = video;\n\n                // add Poster attribute to self-hosted video\n                if ( 'local' === self.video.type ) {\n                    if ( self.image.src ) {\n                        self.$video.setAttribute( 'poster', self.image.src );\n                    } else if ( self.image.$item && 'IMG' === self.image.$item.tagName && self.image.$item.src ) {\n                        self.$video.setAttribute( 'poster', self.image.$item.src );\n                    }\n                }\n\n                // insert video tag\n                self.image.$container.appendChild( video );\n\n                // remove parent video element (created by VideoWorker)\n                $parent.parentNode.removeChild( $parent );\n            } );\n        }\n    };\n\n    // cover video\n    const defCoverImage = Jarallax.prototype.coverImage;\n    Jarallax.prototype.coverImage = function() {\n        const self = this;\n        const imageData = defCoverImage.apply( self );\n        const node = self.image.$item ? self.image.$item.nodeName : false;\n\n        if ( imageData && self.video && node && ( 'IFRAME' === node || 'VIDEO' === node ) ) {\n            let h = imageData.image.height;\n            let w = ( h * self.image.width ) / self.image.height;\n            let ml = ( imageData.container.width - w ) / 2;\n            let mt = imageData.image.marginTop;\n\n            if ( imageData.container.width > w ) {\n                w = imageData.container.width;\n                h = ( w * self.image.height ) / self.image.width;\n                ml = 0;\n                mt += ( imageData.image.height - h ) / 2;\n            }\n\n            // add video height over than need to hide controls\n            if ( 'IFRAME' === node ) {\n                h += 400;\n                mt -= 200;\n            }\n\n            self.css( self.$video, {\n                width: `${ w }px`,\n                marginLeft: `${ ml }px`,\n                height: `${ h }px`,\n                marginTop: `${ mt }px`,\n            } );\n        }\n\n        return imageData;\n    };\n\n    // init video\n    const defInitImg = Jarallax.prototype.initImg;\n    Jarallax.prototype.initImg = function() {\n        const self = this;\n        const defaultResult = defInitImg.apply( self );\n\n        if ( ! self.options.videoSrc ) {\n            self.options.videoSrc = self.$item.getAttribute( 'data-jarallax-video' ) || null;\n        }\n\n        if ( self.options.videoSrc ) {\n            self.defaultInitImgResult = defaultResult;\n            return true;\n        }\n\n        return defaultResult;\n    };\n\n    const defCanInitParallax = Jarallax.prototype.canInitParallax;\n    Jarallax.prototype.canInitParallax = function() {\n        const self = this;\n        let defaultResult = defCanInitParallax.apply( self );\n\n        if ( ! self.options.videoSrc ) {\n            return defaultResult;\n        }\n\n        // Init video api\n        const video = new VideoWorker( self.options.videoSrc, {\n            autoplay: true,\n            loop: self.options.videoLoop,\n            showControls: false,\n            accessibilityHidden: true,\n            startTime: self.options.videoStartTime || 0,\n            endTime: self.options.videoEndTime || 0,\n            mute: self.options.videoVolume ? 0 : 1,\n            volume: self.options.videoVolume || 0,\n        } );\n\n        function resetDefaultImage() {\n            if ( self.image.$default_item ) {\n                self.image.$item = self.image.$default_item;\n                self.image.$item.style.display = 'block';\n\n                // set image width and height\n                self.coverImage();\n                self.clipContainer();\n                self.onScroll();\n            }\n        }\n\n        if ( video.isValid() ) {\n            // Force enable parallax.\n            // When the parallax disabled on mobile devices, we still need to display videos.\n            // https://github.com/nk-o/jarallax/issues/159\n            if ( this.options.disableParallax() ) {\n                defaultResult = true;\n                self.image.position = 'absolute';\n                self.options.type = 'scroll';\n                self.options.speed = 1;\n            }\n\n            // if parallax will not be inited, we can add thumbnail on background.\n            if ( ! defaultResult ) {\n                if ( ! self.defaultInitImgResult ) {\n                    video.getImageURL( ( url ) => {\n                        // save default user styles\n                        const curStyle = self.$item.getAttribute( 'style' );\n                        if ( curStyle ) {\n                            self.$item.setAttribute( 'data-jarallax-original-styles', curStyle );\n                        }\n\n                        // set new background\n                        self.css( self.$item, {\n                            'background-image': `url(\"${ url }\")`,\n                            'background-position': 'center',\n                            'background-size': 'cover',\n                        } );\n                    } );\n                }\n\n                // init video\n            } else {\n                video.on( 'ready', () => {\n                    if ( self.options.videoPlayOnlyVisible ) {\n                        const oldOnScroll = self.onScroll;\n                        self.onScroll = function() {\n                            oldOnScroll.apply( self );\n                            if ( ! self.videoError && ( self.options.videoLoop || ( ! self.options.videoLoop && ! self.videoEnded ) ) ) {\n                                if ( self.isVisible() ) {\n                                    video.play();\n                                } else {\n                                    video.pause();\n                                }\n                            }\n                        };\n                    } else {\n                        video.play();\n                    }\n                } );\n                video.on( 'started', () => {\n                    self.image.$default_item = self.image.$item;\n                    self.image.$item = self.$video;\n\n                    // set video width and height\n                    self.image.width = self.video.videoWidth || 1280;\n                    self.image.height = self.video.videoHeight || 720;\n                    self.coverImage();\n                    self.clipContainer();\n                    self.onScroll();\n\n                    // hide image\n                    if ( self.image.$default_item ) {\n                        self.image.$default_item.style.display = 'none';\n                    }\n                } );\n\n                video.on( 'ended', () => {\n                    self.videoEnded = true;\n\n                    if ( ! self.options.videoLoop ) {\n                        // show default image if Loop disabled.\n                        resetDefaultImage();\n                    }\n                } );\n                video.on( 'error', () => {\n                    self.videoError = true;\n\n                    // show default image if video loading error.\n                    resetDefaultImage();\n                } );\n\n                self.video = video;\n\n                // set image if not exists\n                if ( ! self.defaultInitImgResult ) {\n                    // set empty image on self-hosted video if not defined\n                    self.image.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n\n                    if ( 'local' !== video.type ) {\n                        video.getImageURL( ( url ) => {\n                            self.image.bgImage = `url(\"${ url }\")`;\n                            self.init();\n                        } );\n\n                        return false;\n                    }\n                }\n            }\n        }\n\n        return defaultResult;\n    };\n\n    // Destroy video parallax\n    const defDestroy = Jarallax.prototype.destroy;\n    Jarallax.prototype.destroy = function() {\n        const self = this;\n\n        if ( self.image.$default_item ) {\n            self.image.$item = self.image.$default_item;\n            delete self.image.$default_item;\n        }\n\n        defDestroy.apply( self );\n    };\n}\n"]},"metadata":{},"sourceType":"module"}