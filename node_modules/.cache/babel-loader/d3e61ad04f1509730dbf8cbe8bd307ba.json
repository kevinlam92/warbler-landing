{"ast":null,"code":"import global from 'global'; // Deferred\n// thanks http://stackoverflow.com/questions/18096715/implement-deferred-object-without-using-jquery\n\nfunction Deferred() {\n  this.doneCallbacks = [];\n  this.failCallbacks = [];\n}\n\nDeferred.prototype = {\n  execute(list, args) {\n    let i = list.length;\n    args = Array.prototype.slice.call(args);\n\n    while (i) {\n      i -= 1;\n      list[i].apply(null, args);\n    }\n  },\n\n  resolve() {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    this.execute(this.doneCallbacks, args);\n  },\n\n  reject() {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    this.execute(this.failCallbacks, args);\n  },\n\n  done(callback) {\n    this.doneCallbacks.push(callback);\n  },\n\n  fail(callback) {\n    this.failCallbacks.push(callback);\n  }\n\n};\nlet ID = 0;\nlet YoutubeAPIadded = 0;\nlet VimeoAPIadded = 0;\nlet loadingYoutubePlayer = 0;\nlet loadingVimeoPlayer = 0;\nconst loadingYoutubeDefer = new Deferred();\nconst loadingVimeoDefer = new Deferred();\nexport default class VideoWorker {\n  constructor(url, options) {\n    const self = this;\n    self.url = url;\n    self.options_default = {\n      autoplay: false,\n      loop: false,\n      mute: false,\n      volume: 100,\n      showControls: true,\n      accessibilityHidden: false,\n      // start / end video time in seconds\n      startTime: 0,\n      endTime: 0\n    };\n    self.options = self.extend({}, self.options_default, options); // Fix wrong option name.\n    // Thanks to https://github.com/nk-o/video-worker/issues/13.\n\n    if ('undefined' !== typeof self.options.showContols) {\n      self.options.showControls = self.options.showContols;\n      delete self.options.showContols;\n    } // check URL\n\n\n    self.videoID = self.parseURL(url); // init\n\n    if (self.videoID) {\n      self.ID = ID;\n      ID += 1;\n      self.loadAPI();\n      self.init();\n    }\n  } // Extend like jQuery.extend\n  // eslint-disable-next-line class-methods-use-this\n\n\n  extend() {\n    for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    const out = args[0] || {};\n    Object.keys(args).forEach(i => {\n      if (!args[i]) {\n        return;\n      }\n\n      Object.keys(args[i]).forEach(key => {\n        out[key] = args[i][key];\n      });\n    });\n    return out;\n  }\n\n  parseURL(url) {\n    // parse youtube ID\n    function getYoutubeID(ytUrl) {\n      // eslint-disable-next-line no-useless-escape\n      const regExp = /.*(?:youtu.be\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=)([^#\\&\\?]*).*/;\n      const match = ytUrl.match(regExp);\n      return match && 11 === match[1].length ? match[1] : false;\n    } // parse vimeo ID\n\n\n    function getVimeoID(vmUrl) {\n      // eslint-disable-next-line no-useless-escape\n      const regExp = /https?:\\/\\/(?:www\\.|player\\.)?vimeo.com\\/(?:channels\\/(?:\\w+\\/)?|groups\\/([^\\/]*)\\/videos\\/|album\\/(\\d+)\\/video\\/|video\\/|)(\\d+)(?:$|\\/|\\?)/;\n      const match = vmUrl.match(regExp);\n      return match && match[3] ? match[3] : false;\n    } // parse local string\n\n\n    function getLocalVideos(locUrl) {\n      // eslint-disable-next-line no-useless-escape\n      const videoFormats = locUrl.split(/,(?=mp4\\:|webm\\:|ogv\\:|ogg\\:)/);\n      const result = {};\n      let ready = 0;\n      videoFormats.forEach(val => {\n        // eslint-disable-next-line no-useless-escape\n        const match = val.match(/^(mp4|webm|ogv|ogg)\\:(.*)/);\n\n        if (match && match[1] && match[2]) {\n          // eslint-disable-next-line prefer-destructuring\n          result['ogv' === match[1] ? 'ogg' : match[1]] = match[2];\n          ready = 1;\n        }\n      });\n      return ready ? result : false;\n    }\n\n    const Youtube = getYoutubeID(url);\n    const Vimeo = getVimeoID(url);\n    const Local = getLocalVideos(url);\n\n    if (Youtube) {\n      this.type = 'youtube';\n      return Youtube;\n    }\n\n    if (Vimeo) {\n      this.type = 'vimeo';\n      return Vimeo;\n    }\n\n    if (Local) {\n      this.type = 'local';\n      return Local;\n    }\n\n    return false;\n  }\n\n  isValid() {\n    return !!this.videoID;\n  } // events\n\n\n  on(name, callback) {\n    this.userEventsList = this.userEventsList || []; // add new callback in events list\n\n    (this.userEventsList[name] || (this.userEventsList[name] = [])).push(callback);\n  }\n\n  off(name, callback) {\n    if (!this.userEventsList || !this.userEventsList[name]) {\n      return;\n    }\n\n    if (!callback) {\n      delete this.userEventsList[name];\n    } else {\n      this.userEventsList[name].forEach((val, key) => {\n        if (val === callback) {\n          this.userEventsList[name][key] = false;\n        }\n      });\n    }\n  }\n\n  fire(name) {\n    for (var _len4 = arguments.length, args = new Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n      args[_key4 - 1] = arguments[_key4];\n    }\n\n    if (this.userEventsList && 'undefined' !== typeof this.userEventsList[name]) {\n      this.userEventsList[name].forEach(val => {\n        // call with all arguments\n        if (val) {\n          val.apply(this, args);\n        }\n      });\n    }\n  }\n\n  play(start) {\n    const self = this;\n\n    if (!self.player) {\n      return;\n    }\n\n    if ('youtube' === self.type && self.player.playVideo) {\n      if ('undefined' !== typeof start) {\n        self.player.seekTo(start || 0);\n      }\n\n      if (global.YT.PlayerState.PLAYING !== self.player.getPlayerState()) {\n        self.player.playVideo();\n      }\n    }\n\n    if ('vimeo' === self.type) {\n      if ('undefined' !== typeof start) {\n        self.player.setCurrentTime(start);\n      }\n\n      self.player.getPaused().then(paused => {\n        if (paused) {\n          self.player.play();\n        }\n      });\n    }\n\n    if ('local' === self.type) {\n      if ('undefined' !== typeof start) {\n        self.player.currentTime = start;\n      }\n\n      if (self.player.paused) {\n        self.player.play();\n      }\n    }\n  }\n\n  pause() {\n    const self = this;\n\n    if (!self.player) {\n      return;\n    }\n\n    if ('youtube' === self.type && self.player.pauseVideo) {\n      if (global.YT.PlayerState.PLAYING === self.player.getPlayerState()) {\n        self.player.pauseVideo();\n      }\n    }\n\n    if ('vimeo' === self.type) {\n      self.player.getPaused().then(paused => {\n        if (!paused) {\n          self.player.pause();\n        }\n      });\n    }\n\n    if ('local' === self.type) {\n      if (!self.player.paused) {\n        self.player.pause();\n      }\n    }\n  }\n\n  mute() {\n    const self = this;\n\n    if (!self.player) {\n      return;\n    }\n\n    if ('youtube' === self.type && self.player.mute) {\n      self.player.mute();\n    }\n\n    if ('vimeo' === self.type && self.player.setVolume) {\n      self.player.setVolume(0);\n    }\n\n    if ('local' === self.type) {\n      self.$video.muted = true;\n    }\n  }\n\n  unmute() {\n    const self = this;\n\n    if (!self.player) {\n      return;\n    }\n\n    if ('youtube' === self.type && self.player.mute) {\n      self.player.unMute();\n    }\n\n    if ('vimeo' === self.type && self.player.setVolume) {\n      self.player.setVolume(self.options.volume);\n    }\n\n    if ('local' === self.type) {\n      self.$video.muted = false;\n    }\n  }\n\n  setVolume() {\n    let volume = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;\n    const self = this;\n\n    if (!self.player || !volume) {\n      return;\n    }\n\n    if ('youtube' === self.type && self.player.setVolume) {\n      self.player.setVolume(volume);\n    }\n\n    if ('vimeo' === self.type && self.player.setVolume) {\n      self.player.setVolume(volume);\n    }\n\n    if ('local' === self.type) {\n      self.$video.volume = volume / 100;\n    }\n  }\n\n  getVolume(callback) {\n    const self = this;\n\n    if (!self.player) {\n      callback(false);\n      return;\n    }\n\n    if ('youtube' === self.type && self.player.getVolume) {\n      callback(self.player.getVolume());\n    }\n\n    if ('vimeo' === self.type && self.player.getVolume) {\n      self.player.getVolume().then(volume => {\n        callback(volume);\n      });\n    }\n\n    if ('local' === self.type) {\n      callback(self.$video.volume * 100);\n    }\n  }\n\n  getMuted(callback) {\n    const self = this;\n\n    if (!self.player) {\n      callback(null);\n      return;\n    }\n\n    if ('youtube' === self.type && self.player.isMuted) {\n      callback(self.player.isMuted());\n    }\n\n    if ('vimeo' === self.type && self.player.getVolume) {\n      self.player.getVolume().then(volume => {\n        callback(!!volume);\n      });\n    }\n\n    if ('local' === self.type) {\n      callback(self.$video.muted);\n    }\n  }\n\n  getImageURL(callback) {\n    const self = this;\n\n    if (self.videoImage) {\n      callback(self.videoImage);\n      return;\n    }\n\n    if ('youtube' === self.type) {\n      const availableSizes = ['maxresdefault', 'sddefault', 'hqdefault', '0'];\n      let step = 0;\n      const tempImg = new Image();\n\n      tempImg.onload = function () {\n        // if no thumbnail, youtube add their own image with width = 120px\n        if (120 !== (this.naturalWidth || this.width) || step === availableSizes.length - 1) {\n          // ok\n          self.videoImage = `https://img.youtube.com/vi/${self.videoID}/${availableSizes[step]}.jpg`;\n          callback(self.videoImage);\n        } else {\n          // try another size\n          step += 1;\n          this.src = `https://img.youtube.com/vi/${self.videoID}/${availableSizes[step]}.jpg`;\n        }\n      };\n\n      tempImg.src = `https://img.youtube.com/vi/${self.videoID}/${availableSizes[step]}.jpg`;\n    }\n\n    if ('vimeo' === self.type) {\n      let request = new XMLHttpRequest();\n      request.open('GET', `https://vimeo.com/api/v2/video/${self.videoID}.json`, true);\n\n      request.onreadystatechange = function () {\n        if (4 === this.readyState) {\n          if (200 <= this.status && 400 > this.status) {\n            // Success!\n            const response = JSON.parse(this.responseText);\n            self.videoImage = response[0].thumbnail_large;\n            callback(self.videoImage);\n          } else {// Error :(\n          }\n        }\n      };\n\n      request.send();\n      request = null;\n    }\n  } // fallback to the old version.\n\n\n  getIframe(callback) {\n    this.getVideo(callback);\n  }\n\n  getVideo(callback) {\n    const self = this; // return generated video block\n\n    if (self.$video) {\n      callback(self.$video);\n      return;\n    } // generate new video block\n\n\n    self.onAPIready(() => {\n      let hiddenDiv;\n\n      if (!self.$video) {\n        hiddenDiv = document.createElement('div');\n        hiddenDiv.style.display = 'none';\n      } // Youtube\n\n\n      if ('youtube' === self.type) {\n        self.playerOptions = {\n          // GDPR Compliance.\n          host: 'https://www.youtube-nocookie.com',\n          videoId: self.videoID,\n          playerVars: {\n            autohide: 1,\n            rel: 0,\n            autoplay: 0,\n            // autoplay enable on mobile devices\n            playsinline: 1\n          }\n        }; // hide controls\n\n        if (!self.options.showControls) {\n          self.playerOptions.playerVars.iv_load_policy = 3;\n          self.playerOptions.playerVars.modestbranding = 1;\n          self.playerOptions.playerVars.controls = 0;\n          self.playerOptions.playerVars.showinfo = 0;\n          self.playerOptions.playerVars.disablekb = 1;\n        } // events\n\n\n        let ytStarted;\n        let ytProgressInterval;\n        self.playerOptions.events = {\n          onReady(e) {\n            // mute\n            if (self.options.mute) {\n              e.target.mute();\n            } else if (self.options.volume) {\n              e.target.setVolume(self.options.volume);\n            } // autoplay\n\n\n            if (self.options.autoplay) {\n              self.play(self.options.startTime);\n            }\n\n            self.fire('ready', e); // For seamless loops, set the endTime to 0.1 seconds less than the video's duration\n            // https://github.com/nk-o/video-worker/issues/2\n\n            if (self.options.loop && !self.options.endTime) {\n              const secondsOffset = 0.1;\n              self.options.endTime = self.player.getDuration() - secondsOffset;\n            } // volumechange\n\n\n            setInterval(() => {\n              self.getVolume(volume => {\n                if (self.options.volume !== volume) {\n                  self.options.volume = volume;\n                  self.fire('volumechange', e);\n                }\n              });\n            }, 150);\n          },\n\n          onStateChange(e) {\n            // loop\n            if (self.options.loop && e.data === global.YT.PlayerState.ENDED) {\n              self.play(self.options.startTime);\n            }\n\n            if (!ytStarted && e.data === global.YT.PlayerState.PLAYING) {\n              ytStarted = 1;\n              self.fire('started', e);\n            }\n\n            if (e.data === global.YT.PlayerState.PLAYING) {\n              self.fire('play', e);\n            }\n\n            if (e.data === global.YT.PlayerState.PAUSED) {\n              self.fire('pause', e);\n            }\n\n            if (e.data === global.YT.PlayerState.ENDED) {\n              self.fire('ended', e);\n            } // progress check\n\n\n            if (e.data === global.YT.PlayerState.PLAYING) {\n              ytProgressInterval = setInterval(() => {\n                self.fire('timeupdate', e); // check for end of video and play again or stop\n\n                if (self.options.endTime && self.player.getCurrentTime() >= self.options.endTime) {\n                  if (self.options.loop) {\n                    self.play(self.options.startTime);\n                  } else {\n                    self.pause();\n                  }\n                }\n              }, 150);\n            } else {\n              clearInterval(ytProgressInterval);\n            }\n          },\n\n          onError(e) {\n            self.fire('error', e);\n          }\n\n        };\n        const firstInit = !self.$video;\n\n        if (firstInit) {\n          const div = document.createElement('div');\n          div.setAttribute('id', self.playerID);\n          hiddenDiv.appendChild(div);\n          document.body.appendChild(hiddenDiv);\n        }\n\n        self.player = self.player || new global.YT.Player(self.playerID, self.playerOptions);\n\n        if (firstInit) {\n          self.$video = document.getElementById(self.playerID); // add accessibility attributes\n\n          if (self.options.accessibilityHidden) {\n            self.$video.setAttribute('tabindex', '-1');\n            self.$video.setAttribute('aria-hidden', 'true');\n          } // get video width and height\n\n\n          self.videoWidth = parseInt(self.$video.getAttribute('width'), 10) || 1280;\n          self.videoHeight = parseInt(self.$video.getAttribute('height'), 10) || 720;\n        }\n      } // Vimeo\n\n\n      if ('vimeo' === self.type) {\n        self.playerOptions = {\n          // GDPR Compliance.\n          dnt: 1,\n          id: self.videoID,\n          autopause: 0,\n          transparent: 0,\n          autoplay: self.options.autoplay ? 1 : 0,\n          loop: self.options.loop ? 1 : 0,\n          muted: self.options.mute ? 1 : 0\n        };\n\n        if (self.options.volume) {\n          self.playerOptions.volume = self.options.volume;\n        } // hide controls\n\n\n        if (!self.options.showControls) {\n          self.playerOptions.badge = 0;\n          self.playerOptions.byline = 0;\n          self.playerOptions.portrait = 0;\n          self.playerOptions.title = 0;\n          self.playerOptions.background = 1;\n        }\n\n        if (!self.$video) {\n          let playerOptionsString = '';\n          Object.keys(self.playerOptions).forEach(key => {\n            if ('' !== playerOptionsString) {\n              playerOptionsString += '&';\n            }\n\n            playerOptionsString += `${key}=${encodeURIComponent(self.playerOptions[key])}`;\n          }); // we need to create iframe manually because when we create it using API\n          // js events won't triggers after iframe moved to another place\n\n          self.$video = document.createElement('iframe');\n          self.$video.setAttribute('id', self.playerID);\n          self.$video.setAttribute('src', `https://player.vimeo.com/video/${self.videoID}?${playerOptionsString}`);\n          self.$video.setAttribute('frameborder', '0');\n          self.$video.setAttribute('mozallowfullscreen', '');\n          self.$video.setAttribute('allowfullscreen', '');\n          self.$video.setAttribute('title', 'Vimeo video player'); // add accessibility attributes\n\n          if (self.options.accessibilityHidden) {\n            self.$video.setAttribute('tabindex', '-1');\n            self.$video.setAttribute('aria-hidden', 'true');\n          }\n\n          hiddenDiv.appendChild(self.$video);\n          document.body.appendChild(hiddenDiv);\n        }\n\n        self.player = self.player || new global.Vimeo.Player(self.$video, self.playerOptions); // set current time for autoplay\n\n        if (self.options.startTime && self.options.autoplay) {\n          self.player.setCurrentTime(self.options.startTime);\n        } // get video width and height\n\n\n        self.player.getVideoWidth().then(width => {\n          self.videoWidth = width || 1280;\n        });\n        self.player.getVideoHeight().then(height => {\n          self.videoHeight = height || 720;\n        }); // events\n\n        let vmStarted;\n        self.player.on('timeupdate', e => {\n          if (!vmStarted) {\n            self.fire('started', e);\n            vmStarted = 1;\n          }\n\n          self.fire('timeupdate', e); // check for end of video and play again or stop\n\n          if (self.options.endTime) {\n            if (self.options.endTime && e.seconds >= self.options.endTime) {\n              if (self.options.loop) {\n                self.play(self.options.startTime);\n              } else {\n                self.pause();\n              }\n            }\n          }\n        });\n        self.player.on('play', e => {\n          self.fire('play', e); // check for the start time and start with it\n\n          if (self.options.startTime && 0 === e.seconds) {\n            self.play(self.options.startTime);\n          }\n        });\n        self.player.on('pause', e => {\n          self.fire('pause', e);\n        });\n        self.player.on('ended', e => {\n          self.fire('ended', e);\n        });\n        self.player.on('loaded', e => {\n          self.fire('ready', e);\n        });\n        self.player.on('volumechange', e => {\n          self.fire('volumechange', e);\n        });\n        self.player.on('error', e => {\n          self.fire('error', e);\n        });\n      } // Local\n\n\n      function addSourceToLocal(element, src, type) {\n        const source = document.createElement('source');\n        source.src = src;\n        source.type = type;\n        element.appendChild(source);\n      }\n\n      if ('local' === self.type) {\n        if (!self.$video) {\n          self.$video = document.createElement('video'); // show controls\n\n          if (self.options.showControls) {\n            self.$video.controls = true;\n          } // mute\n\n\n          if (self.options.mute) {\n            self.$video.muted = true;\n          } else if (self.$video.volume) {\n            self.$video.volume = self.options.volume / 100;\n          } // loop\n\n\n          if (self.options.loop) {\n            self.$video.loop = true;\n          } // autoplay enable on mobile devices\n\n\n          self.$video.setAttribute('playsinline', '');\n          self.$video.setAttribute('webkit-playsinline', ''); // add accessibility attributes\n\n          if (self.options.accessibilityHidden) {\n            self.$video.setAttribute('tabindex', '-1');\n            self.$video.setAttribute('aria-hidden', 'true');\n          }\n\n          self.$video.setAttribute('id', self.playerID);\n          hiddenDiv.appendChild(self.$video);\n          document.body.appendChild(hiddenDiv);\n          Object.keys(self.videoID).forEach(key => {\n            addSourceToLocal(self.$video, self.videoID[key], `video/${key}`);\n          });\n        }\n\n        self.player = self.player || self.$video;\n        let locStarted;\n        self.player.addEventListener('playing', e => {\n          if (!locStarted) {\n            self.fire('started', e);\n          }\n\n          locStarted = 1;\n        });\n        self.player.addEventListener('timeupdate', function (e) {\n          self.fire('timeupdate', e); // check for end of video and play again or stop\n\n          if (self.options.endTime) {\n            if (self.options.endTime && this.currentTime >= self.options.endTime) {\n              if (self.options.loop) {\n                self.play(self.options.startTime);\n              } else {\n                self.pause();\n              }\n            }\n          }\n        });\n        self.player.addEventListener('play', e => {\n          self.fire('play', e);\n        });\n        self.player.addEventListener('pause', e => {\n          self.fire('pause', e);\n        });\n        self.player.addEventListener('ended', e => {\n          self.fire('ended', e);\n        });\n        self.player.addEventListener('loadedmetadata', function () {\n          // get video width and height\n          self.videoWidth = this.videoWidth || 1280;\n          self.videoHeight = this.videoHeight || 720;\n          self.fire('ready'); // autoplay\n\n          if (self.options.autoplay) {\n            self.play(self.options.startTime);\n          }\n        });\n        self.player.addEventListener('volumechange', e => {\n          self.getVolume(volume => {\n            self.options.volume = volume;\n          });\n          self.fire('volumechange', e);\n        });\n        self.player.addEventListener('error', e => {\n          self.fire('error', e);\n        });\n      }\n\n      callback(self.$video);\n    });\n  }\n\n  init() {\n    const self = this;\n    self.playerID = `VideoWorker-${self.ID}`;\n  }\n\n  loadAPI() {\n    const self = this;\n\n    if (YoutubeAPIadded && VimeoAPIadded) {\n      return;\n    }\n\n    let src = ''; // load Youtube API\n\n    if ('youtube' === self.type && !YoutubeAPIadded) {\n      YoutubeAPIadded = 1;\n      src = 'https://www.youtube.com/iframe_api';\n    } // load Vimeo API\n\n\n    if ('vimeo' === self.type && !VimeoAPIadded) {\n      VimeoAPIadded = 1; // Useful when Vimeo API added using RequireJS https://github.com/nk-o/video-worker/pull/7\n\n      if ('undefined' !== typeof global.Vimeo) {\n        return;\n      }\n\n      src = 'https://player.vimeo.com/api/player.js';\n    }\n\n    if (!src) {\n      return;\n    } // add script in head section\n\n\n    let tag = document.createElement('script');\n    let head = document.getElementsByTagName('head')[0];\n    tag.src = src;\n    head.appendChild(tag);\n    head = null;\n    tag = null;\n  }\n\n  onAPIready(callback) {\n    const self = this; // Youtube\n\n    if ('youtube' === self.type) {\n      // Listen for global YT player callback\n      if (('undefined' === typeof global.YT || 0 === global.YT.loaded) && !loadingYoutubePlayer) {\n        // Prevents Ready event from being called twice\n        loadingYoutubePlayer = 1; // Creates deferred so, other players know when to wait.\n\n        window.onYouTubeIframeAPIReady = function () {\n          window.onYouTubeIframeAPIReady = null;\n          loadingYoutubeDefer.resolve('done');\n          callback();\n        };\n      } else if ('object' === typeof global.YT && 1 === global.YT.loaded) {\n        callback();\n      } else {\n        loadingYoutubeDefer.done(() => {\n          callback();\n        });\n      }\n    } // Vimeo\n\n\n    if ('vimeo' === self.type) {\n      if ('undefined' === typeof global.Vimeo && !loadingVimeoPlayer) {\n        loadingVimeoPlayer = 1;\n        const vimeoInterval = setInterval(() => {\n          if ('undefined' !== typeof global.Vimeo) {\n            clearInterval(vimeoInterval);\n            loadingVimeoDefer.resolve('done');\n            callback();\n          }\n        }, 20);\n      } else if ('undefined' !== typeof global.Vimeo) {\n        callback();\n      } else {\n        loadingVimeoDefer.done(() => {\n          callback();\n        });\n      }\n    } // Local\n\n\n    if ('local' === self.type) {\n      callback();\n    }\n  }\n\n}","map":{"version":3,"sources":["/Users/kevin/workspace/don-website/node_modules/video-worker/src/video-worker.esm.js"],"names":["global","Deferred","doneCallbacks","failCallbacks","prototype","execute","list","args","i","length","Array","slice","call","apply","resolve","reject","done","callback","push","fail","ID","YoutubeAPIadded","VimeoAPIadded","loadingYoutubePlayer","loadingVimeoPlayer","loadingYoutubeDefer","loadingVimeoDefer","VideoWorker","constructor","url","options","self","options_default","autoplay","loop","mute","volume","showControls","accessibilityHidden","startTime","endTime","extend","showContols","videoID","parseURL","loadAPI","init","out","Object","keys","forEach","key","getYoutubeID","ytUrl","regExp","match","getVimeoID","vmUrl","getLocalVideos","locUrl","videoFormats","split","result","ready","val","Youtube","Vimeo","Local","type","isValid","on","name","userEventsList","off","fire","play","start","player","playVideo","seekTo","YT","PlayerState","PLAYING","getPlayerState","setCurrentTime","getPaused","then","paused","currentTime","pause","pauseVideo","setVolume","$video","muted","unmute","unMute","getVolume","getMuted","isMuted","getImageURL","videoImage","availableSizes","step","tempImg","Image","onload","naturalWidth","width","src","request","XMLHttpRequest","open","onreadystatechange","readyState","status","response","JSON","parse","responseText","thumbnail_large","send","getIframe","getVideo","onAPIready","hiddenDiv","document","createElement","style","display","playerOptions","host","videoId","playerVars","autohide","rel","playsinline","iv_load_policy","modestbranding","controls","showinfo","disablekb","ytStarted","ytProgressInterval","events","onReady","e","target","secondsOffset","getDuration","setInterval","onStateChange","data","ENDED","PAUSED","getCurrentTime","clearInterval","onError","firstInit","div","setAttribute","playerID","appendChild","body","Player","getElementById","videoWidth","parseInt","getAttribute","videoHeight","dnt","id","autopause","transparent","badge","byline","portrait","title","background","playerOptionsString","encodeURIComponent","getVideoWidth","getVideoHeight","height","vmStarted","seconds","addSourceToLocal","element","source","locStarted","addEventListener","tag","head","getElementsByTagName","loaded","window","onYouTubeIframeAPIReady","vimeoInterval"],"mappings":"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","sourcesContent":["import global from 'global';\n\n// Deferred\n// thanks http://stackoverflow.com/questions/18096715/implement-deferred-object-without-using-jquery\nfunction Deferred() {\n    this.doneCallbacks = [];\n    this.failCallbacks = [];\n}\n\nDeferred.prototype = {\n    execute( list, args ) {\n        let i = list.length;\n        args = Array.prototype.slice.call( args );\n\n        while ( i ) {\n            i -= 1;\n            list[ i ].apply( null, args );\n        }\n    },\n    resolve( ...args ) {\n        this.execute( this.doneCallbacks, args );\n    },\n    reject( ...args ) {\n        this.execute( this.failCallbacks, args );\n    },\n    done( callback ) {\n        this.doneCallbacks.push( callback );\n    },\n    fail( callback ) {\n        this.failCallbacks.push( callback );\n    },\n};\n\nlet ID = 0;\nlet YoutubeAPIadded = 0;\nlet VimeoAPIadded = 0;\nlet loadingYoutubePlayer = 0;\nlet loadingVimeoPlayer = 0;\nconst loadingYoutubeDefer = new Deferred();\nconst loadingVimeoDefer = new Deferred();\n\nexport default class VideoWorker {\n    constructor( url, options ) {\n        const self = this;\n\n        self.url = url;\n\n        self.options_default = {\n            autoplay: false,\n            loop: false,\n            mute: false,\n            volume: 100,\n            showControls: true,\n            accessibilityHidden: false,\n\n            // start / end video time in seconds\n            startTime: 0,\n            endTime: 0,\n        };\n\n        self.options = self.extend( {}, self.options_default, options );\n\n        // Fix wrong option name.\n        // Thanks to https://github.com/nk-o/video-worker/issues/13.\n        if ( 'undefined' !== typeof self.options.showContols ) {\n            self.options.showControls = self.options.showContols;\n            delete self.options.showContols;\n        }\n\n        // check URL\n        self.videoID = self.parseURL( url );\n\n        // init\n        if ( self.videoID ) {\n            self.ID = ID;\n            ID += 1;\n            self.loadAPI();\n            self.init();\n        }\n    }\n\n    // Extend like jQuery.extend\n    // eslint-disable-next-line class-methods-use-this\n    extend( ...args ) {\n        const out = args[ 0 ] || {};\n\n        Object.keys( args ).forEach( ( i ) => {\n            if ( ! args[ i ] ) {\n                return;\n            }\n            Object.keys( args[ i ] ).forEach( ( key ) => {\n                out[ key ] = args[ i ][ key ];\n            } );\n        } );\n\n        return out;\n    }\n\n    parseURL( url ) {\n        // parse youtube ID\n        function getYoutubeID( ytUrl ) {\n            // eslint-disable-next-line no-useless-escape\n            const regExp = /.*(?:youtu.be\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=)([^#\\&\\?]*).*/;\n            const match = ytUrl.match( regExp );\n            return match && 11 === match[ 1 ].length ? match[ 1 ] : false;\n        }\n\n        // parse vimeo ID\n        function getVimeoID( vmUrl ) {\n            // eslint-disable-next-line no-useless-escape\n            const regExp = /https?:\\/\\/(?:www\\.|player\\.)?vimeo.com\\/(?:channels\\/(?:\\w+\\/)?|groups\\/([^\\/]*)\\/videos\\/|album\\/(\\d+)\\/video\\/|video\\/|)(\\d+)(?:$|\\/|\\?)/;\n            const match = vmUrl.match( regExp );\n            return match && match[ 3 ] ? match[ 3 ] : false;\n        }\n\n        // parse local string\n        function getLocalVideos( locUrl ) {\n            // eslint-disable-next-line no-useless-escape\n            const videoFormats = locUrl.split( /,(?=mp4\\:|webm\\:|ogv\\:|ogg\\:)/ );\n            const result = {};\n            let ready = 0;\n            videoFormats.forEach( ( val ) => {\n                // eslint-disable-next-line no-useless-escape\n                const match = val.match( /^(mp4|webm|ogv|ogg)\\:(.*)/ );\n                if ( match && match[ 1 ] && match[ 2 ] ) {\n                    // eslint-disable-next-line prefer-destructuring\n                    result[ 'ogv' === match[ 1 ] ? 'ogg' : match[ 1 ] ] = match[ 2 ];\n                    ready = 1;\n                }\n            } );\n            return ready ? result : false;\n        }\n\n        const Youtube = getYoutubeID( url );\n        const Vimeo = getVimeoID( url );\n        const Local = getLocalVideos( url );\n\n        if ( Youtube ) {\n            this.type = 'youtube';\n            return Youtube;\n        }\n\n        if ( Vimeo ) {\n            this.type = 'vimeo';\n            return Vimeo;\n        }\n\n        if ( Local ) {\n            this.type = 'local';\n            return Local;\n        }\n\n        return false;\n    }\n\n    isValid() {\n        return !! this.videoID;\n    }\n\n    // events\n    on( name, callback ) {\n        this.userEventsList = this.userEventsList || [];\n\n        // add new callback in events list\n        ( this.userEventsList[ name ] || ( this.userEventsList[ name ] = [] ) ).push( callback );\n    }\n\n    off( name, callback ) {\n        if ( ! this.userEventsList || ! this.userEventsList[ name ] ) {\n            return;\n        }\n\n        if ( ! callback ) {\n            delete this.userEventsList[ name ];\n        } else {\n            this.userEventsList[ name ].forEach( ( val, key ) => {\n                if ( val === callback ) {\n                    this.userEventsList[ name ][ key ] = false;\n                }\n            } );\n        }\n    }\n\n    fire( name, ...args ) {\n        if ( this.userEventsList && 'undefined' !== typeof this.userEventsList[ name ] ) {\n            this.userEventsList[ name ].forEach( ( val ) => {\n                // call with all arguments\n                if ( val ) {\n                    val.apply( this, args );\n                }\n            } );\n        }\n    }\n\n    play( start ) {\n        const self = this;\n        if ( ! self.player ) {\n            return;\n        }\n\n        if ( 'youtube' === self.type && self.player.playVideo ) {\n            if ( 'undefined' !== typeof start ) {\n                self.player.seekTo( start || 0 );\n            }\n            if ( global.YT.PlayerState.PLAYING !== self.player.getPlayerState() ) {\n                self.player.playVideo();\n            }\n        }\n\n        if ( 'vimeo' === self.type ) {\n            if ( 'undefined' !== typeof start ) {\n                self.player.setCurrentTime( start );\n            }\n            self.player.getPaused().then( ( paused ) => {\n                if ( paused ) {\n                    self.player.play();\n                }\n            } );\n        }\n\n        if ( 'local' === self.type ) {\n            if ( 'undefined' !== typeof start ) {\n                self.player.currentTime = start;\n            }\n            if ( self.player.paused ) {\n                self.player.play();\n            }\n        }\n    }\n\n    pause() {\n        const self = this;\n        if ( ! self.player ) {\n            return;\n        }\n\n        if ( 'youtube' === self.type && self.player.pauseVideo ) {\n            if ( global.YT.PlayerState.PLAYING === self.player.getPlayerState() ) {\n                self.player.pauseVideo();\n            }\n        }\n\n        if ( 'vimeo' === self.type ) {\n            self.player.getPaused().then( ( paused ) => {\n                if ( ! paused ) {\n                    self.player.pause();\n                }\n            } );\n        }\n\n        if ( 'local' === self.type ) {\n            if ( ! self.player.paused ) {\n                self.player.pause();\n            }\n        }\n    }\n\n    mute() {\n        const self = this;\n        if ( ! self.player ) {\n            return;\n        }\n\n        if ( 'youtube' === self.type && self.player.mute ) {\n            self.player.mute();\n        }\n\n        if ( 'vimeo' === self.type && self.player.setVolume ) {\n            self.player.setVolume( 0 );\n        }\n\n        if ( 'local' === self.type ) {\n            self.$video.muted = true;\n        }\n    }\n\n    unmute() {\n        const self = this;\n        if ( ! self.player ) {\n            return;\n        }\n\n        if ( 'youtube' === self.type && self.player.mute ) {\n            self.player.unMute();\n        }\n\n        if ( 'vimeo' === self.type && self.player.setVolume ) {\n            self.player.setVolume( self.options.volume );\n        }\n\n        if ( 'local' === self.type ) {\n            self.$video.muted = false;\n        }\n    }\n\n    setVolume( volume = false ) {\n        const self = this;\n        if ( ! self.player || ! volume ) {\n            return;\n        }\n\n        if ( 'youtube' === self.type && self.player.setVolume ) {\n            self.player.setVolume( volume );\n        }\n\n        if ( 'vimeo' === self.type && self.player.setVolume ) {\n            self.player.setVolume( volume );\n        }\n\n        if ( 'local' === self.type ) {\n            self.$video.volume = volume / 100;\n        }\n    }\n\n    getVolume( callback ) {\n        const self = this;\n        if ( ! self.player ) {\n            callback( false );\n            return;\n        }\n\n        if ( 'youtube' === self.type && self.player.getVolume ) {\n            callback( self.player.getVolume() );\n        }\n\n        if ( 'vimeo' === self.type && self.player.getVolume ) {\n            self.player.getVolume().then( ( volume ) => {\n                callback( volume );\n            } );\n        }\n\n        if ( 'local' === self.type ) {\n            callback( self.$video.volume * 100 );\n        }\n    }\n\n    getMuted( callback ) {\n        const self = this;\n        if ( ! self.player ) {\n            callback( null );\n            return;\n        }\n\n        if ( 'youtube' === self.type && self.player.isMuted ) {\n            callback( self.player.isMuted() );\n        }\n\n        if ( 'vimeo' === self.type && self.player.getVolume ) {\n            self.player.getVolume().then( ( volume ) => {\n                callback( !! volume );\n            } );\n        }\n\n        if ( 'local' === self.type ) {\n            callback( self.$video.muted );\n        }\n    }\n\n    getImageURL( callback ) {\n        const self = this;\n\n        if ( self.videoImage ) {\n            callback( self.videoImage );\n            return;\n        }\n\n        if ( 'youtube' === self.type ) {\n            const availableSizes = [\n                'maxresdefault',\n                'sddefault',\n                'hqdefault',\n                '0',\n            ];\n            let step = 0;\n\n            const tempImg = new Image();\n            tempImg.onload = function() {\n                // if no thumbnail, youtube add their own image with width = 120px\n                if ( 120 !== ( this.naturalWidth || this.width ) || step === availableSizes.length - 1 ) {\n                    // ok\n                    self.videoImage = `https://img.youtube.com/vi/${ self.videoID }/${ availableSizes[ step ] }.jpg`;\n                    callback( self.videoImage );\n                } else {\n                    // try another size\n                    step += 1;\n                    this.src = `https://img.youtube.com/vi/${ self.videoID }/${ availableSizes[ step ] }.jpg`;\n                }\n            };\n            tempImg.src = `https://img.youtube.com/vi/${ self.videoID }/${ availableSizes[ step ] }.jpg`;\n        }\n\n        if ( 'vimeo' === self.type ) {\n            let request = new XMLHttpRequest();\n            request.open( 'GET', `https://vimeo.com/api/v2/video/${ self.videoID }.json`, true );\n            request.onreadystatechange = function() {\n                if ( 4 === this.readyState ) {\n                    if ( 200 <= this.status && 400 > this.status ) {\n                        // Success!\n                        const response = JSON.parse( this.responseText );\n                        self.videoImage = response[ 0 ].thumbnail_large;\n                        callback( self.videoImage );\n                    } else {\n                        // Error :(\n                    }\n                }\n            };\n            request.send();\n            request = null;\n        }\n    }\n\n    // fallback to the old version.\n    getIframe( callback ) {\n        this.getVideo( callback );\n    }\n\n    getVideo( callback ) {\n        const self = this;\n\n        // return generated video block\n        if ( self.$video ) {\n            callback( self.$video );\n            return;\n        }\n\n        // generate new video block\n        self.onAPIready( () => {\n            let hiddenDiv;\n            if ( ! self.$video ) {\n                hiddenDiv = document.createElement( 'div' );\n                hiddenDiv.style.display = 'none';\n            }\n\n            // Youtube\n            if ( 'youtube' === self.type ) {\n                self.playerOptions = {\n                    // GDPR Compliance.\n                    host: 'https://www.youtube-nocookie.com',\n                    videoId: self.videoID,\n                    playerVars: {\n                        autohide: 1,\n                        rel: 0,\n                        autoplay: 0,\n                        // autoplay enable on mobile devices\n                        playsinline: 1,\n                    },\n                };\n\n                // hide controls\n                if ( ! self.options.showControls ) {\n                    self.playerOptions.playerVars.iv_load_policy = 3;\n                    self.playerOptions.playerVars.modestbranding = 1;\n                    self.playerOptions.playerVars.controls = 0;\n                    self.playerOptions.playerVars.showinfo = 0;\n                    self.playerOptions.playerVars.disablekb = 1;\n                }\n\n                // events\n                let ytStarted;\n                let ytProgressInterval;\n                self.playerOptions.events = {\n                    onReady( e ) {\n                        // mute\n                        if ( self.options.mute ) {\n                            e.target.mute();\n                        } else if ( self.options.volume ) {\n                            e.target.setVolume( self.options.volume );\n                        }\n\n                        // autoplay\n                        if ( self.options.autoplay ) {\n                            self.play( self.options.startTime );\n                        }\n                        self.fire( 'ready', e );\n\n                        // For seamless loops, set the endTime to 0.1 seconds less than the video's duration\n                        // https://github.com/nk-o/video-worker/issues/2\n                        if ( self.options.loop && ! self.options.endTime ) {\n                            const secondsOffset = 0.1;\n                            self.options.endTime = self.player.getDuration() - secondsOffset;\n                        }\n\n                        // volumechange\n                        setInterval( () => {\n                            self.getVolume( ( volume ) => {\n                                if ( self.options.volume !== volume ) {\n                                    self.options.volume = volume;\n                                    self.fire( 'volumechange', e );\n                                }\n                            } );\n                        }, 150 );\n                    },\n                    onStateChange( e ) {\n                        // loop\n                        if ( self.options.loop && e.data === global.YT.PlayerState.ENDED ) {\n                            self.play( self.options.startTime );\n                        }\n                        if ( ! ytStarted && e.data === global.YT.PlayerState.PLAYING ) {\n                            ytStarted = 1;\n                            self.fire( 'started', e );\n                        }\n                        if ( e.data === global.YT.PlayerState.PLAYING ) {\n                            self.fire( 'play', e );\n                        }\n                        if ( e.data === global.YT.PlayerState.PAUSED ) {\n                            self.fire( 'pause', e );\n                        }\n                        if ( e.data === global.YT.PlayerState.ENDED ) {\n                            self.fire( 'ended', e );\n                        }\n\n                        // progress check\n                        if ( e.data === global.YT.PlayerState.PLAYING ) {\n                            ytProgressInterval = setInterval( () => {\n                                self.fire( 'timeupdate', e );\n\n                                // check for end of video and play again or stop\n                                if ( self.options.endTime && self.player.getCurrentTime() >= self.options.endTime ) {\n                                    if ( self.options.loop ) {\n                                        self.play( self.options.startTime );\n                                    } else {\n                                        self.pause();\n                                    }\n                                }\n                            }, 150 );\n                        } else {\n                            clearInterval( ytProgressInterval );\n                        }\n                    },\n                    onError( e ) {\n                        self.fire( 'error', e );\n                    },\n                };\n\n                const firstInit = ! self.$video;\n                if ( firstInit ) {\n                    const div = document.createElement( 'div' );\n                    div.setAttribute( 'id', self.playerID );\n                    hiddenDiv.appendChild( div );\n                    document.body.appendChild( hiddenDiv );\n                }\n                self.player = self.player || new global.YT.Player( self.playerID, self.playerOptions );\n                if ( firstInit ) {\n                    self.$video = document.getElementById( self.playerID );\n\n                    // add accessibility attributes\n                    if ( self.options.accessibilityHidden ) {\n                        self.$video.setAttribute( 'tabindex', '-1' );\n                        self.$video.setAttribute( 'aria-hidden', 'true' );\n                    }\n\n                    // get video width and height\n                    self.videoWidth = parseInt( self.$video.getAttribute( 'width' ), 10 ) || 1280;\n                    self.videoHeight = parseInt( self.$video.getAttribute( 'height' ), 10 ) || 720;\n                }\n            }\n\n            // Vimeo\n            if ( 'vimeo' === self.type ) {\n                self.playerOptions = {\n                    // GDPR Compliance.\n                    dnt: 1,\n                    id: self.videoID,\n                    autopause: 0,\n                    transparent: 0,\n                    autoplay: self.options.autoplay ? 1 : 0,\n                    loop: self.options.loop ? 1 : 0,\n                    muted: self.options.mute ? 1 : 0,\n                };\n\n                if ( self.options.volume ) {\n                    self.playerOptions.volume = self.options.volume;\n                }\n\n                // hide controls\n                if ( ! self.options.showControls ) {\n                    self.playerOptions.badge = 0;\n                    self.playerOptions.byline = 0;\n                    self.playerOptions.portrait = 0;\n                    self.playerOptions.title = 0;\n                    self.playerOptions.background = 1;\n                }\n\n                if ( ! self.$video ) {\n                    let playerOptionsString = '';\n                    Object.keys( self.playerOptions ).forEach( ( key ) => {\n                        if ( '' !== playerOptionsString ) {\n                            playerOptionsString += '&';\n                        }\n                        playerOptionsString += `${ key }=${ encodeURIComponent( self.playerOptions[ key ] ) }`;\n                    } );\n\n                    // we need to create iframe manually because when we create it using API\n                    // js events won't triggers after iframe moved to another place\n                    self.$video = document.createElement( 'iframe' );\n                    self.$video.setAttribute( 'id', self.playerID );\n                    self.$video.setAttribute( 'src', `https://player.vimeo.com/video/${ self.videoID }?${ playerOptionsString }` );\n                    self.$video.setAttribute( 'frameborder', '0' );\n                    self.$video.setAttribute( 'mozallowfullscreen', '' );\n                    self.$video.setAttribute( 'allowfullscreen', '' );\n                    self.$video.setAttribute( 'title', 'Vimeo video player' );\n\n                    // add accessibility attributes\n                    if ( self.options.accessibilityHidden ) {\n                        self.$video.setAttribute( 'tabindex', '-1' );\n                        self.$video.setAttribute( 'aria-hidden', 'true' );\n                    }\n\n                    hiddenDiv.appendChild( self.$video );\n                    document.body.appendChild( hiddenDiv );\n                }\n                self.player = self.player || new global.Vimeo.Player( self.$video, self.playerOptions );\n\n                // set current time for autoplay\n                if ( self.options.startTime && self.options.autoplay ) {\n                    self.player.setCurrentTime( self.options.startTime );\n                }\n\n                // get video width and height\n                self.player.getVideoWidth().then( ( width ) => {\n                    self.videoWidth = width || 1280;\n                } );\n                self.player.getVideoHeight().then( ( height ) => {\n                    self.videoHeight = height || 720;\n                } );\n\n                // events\n                let vmStarted;\n                self.player.on( 'timeupdate', ( e ) => {\n                    if ( ! vmStarted ) {\n                        self.fire( 'started', e );\n                        vmStarted = 1;\n                    }\n\n                    self.fire( 'timeupdate', e );\n\n                    // check for end of video and play again or stop\n                    if ( self.options.endTime ) {\n                        if ( self.options.endTime && e.seconds >= self.options.endTime ) {\n                            if ( self.options.loop ) {\n                                self.play( self.options.startTime );\n                            } else {\n                                self.pause();\n                            }\n                        }\n                    }\n                } );\n                self.player.on( 'play', ( e ) => {\n                    self.fire( 'play', e );\n\n                    // check for the start time and start with it\n                    if ( self.options.startTime && 0 === e.seconds ) {\n                        self.play( self.options.startTime );\n                    }\n                } );\n                self.player.on( 'pause', ( e ) => {\n                    self.fire( 'pause', e );\n                } );\n                self.player.on( 'ended', ( e ) => {\n                    self.fire( 'ended', e );\n                } );\n                self.player.on( 'loaded', ( e ) => {\n                    self.fire( 'ready', e );\n                } );\n                self.player.on( 'volumechange', ( e ) => {\n                    self.fire( 'volumechange', e );\n                } );\n                self.player.on( 'error', ( e ) => {\n                    self.fire( 'error', e );\n                } );\n            }\n\n            // Local\n            function addSourceToLocal( element, src, type ) {\n                const source = document.createElement( 'source' );\n                source.src = src;\n                source.type = type;\n                element.appendChild( source );\n            }\n            if ( 'local' === self.type ) {\n                if ( ! self.$video ) {\n                    self.$video = document.createElement( 'video' );\n\n                    // show controls\n                    if ( self.options.showControls ) {\n                        self.$video.controls = true;\n                    }\n\n                    // mute\n                    if ( self.options.mute ) {\n                        self.$video.muted = true;\n                    } else if ( self.$video.volume ) {\n                        self.$video.volume = self.options.volume / 100;\n                    }\n\n                    // loop\n                    if ( self.options.loop ) {\n                        self.$video.loop = true;\n                    }\n\n                    // autoplay enable on mobile devices\n                    self.$video.setAttribute( 'playsinline', '' );\n                    self.$video.setAttribute( 'webkit-playsinline', '' );\n\n                    // add accessibility attributes\n                    if ( self.options.accessibilityHidden ) {\n                        self.$video.setAttribute( 'tabindex', '-1' );\n                        self.$video.setAttribute( 'aria-hidden', 'true' );\n                    }\n\n                    self.$video.setAttribute( 'id', self.playerID );\n                    hiddenDiv.appendChild( self.$video );\n                    document.body.appendChild( hiddenDiv );\n\n                    Object.keys( self.videoID ).forEach( ( key ) => {\n                        addSourceToLocal( self.$video, self.videoID[ key ], `video/${ key }` );\n                    } );\n                }\n\n                self.player = self.player || self.$video;\n\n                let locStarted;\n                self.player.addEventListener( 'playing', ( e ) => {\n                    if ( ! locStarted ) {\n                        self.fire( 'started', e );\n                    }\n                    locStarted = 1;\n                } );\n                self.player.addEventListener( 'timeupdate', function( e ) {\n                    self.fire( 'timeupdate', e );\n\n                    // check for end of video and play again or stop\n                    if ( self.options.endTime ) {\n                        if ( self.options.endTime && this.currentTime >= self.options.endTime ) {\n                            if ( self.options.loop ) {\n                                self.play( self.options.startTime );\n                            } else {\n                                self.pause();\n                            }\n                        }\n                    }\n                } );\n                self.player.addEventListener( 'play', ( e ) => {\n                    self.fire( 'play', e );\n                } );\n                self.player.addEventListener( 'pause', ( e ) => {\n                    self.fire( 'pause', e );\n                } );\n                self.player.addEventListener( 'ended', ( e ) => {\n                    self.fire( 'ended', e );\n                } );\n                self.player.addEventListener( 'loadedmetadata', function() {\n                    // get video width and height\n                    self.videoWidth = this.videoWidth || 1280;\n                    self.videoHeight = this.videoHeight || 720;\n\n                    self.fire( 'ready' );\n\n                    // autoplay\n                    if ( self.options.autoplay ) {\n                        self.play( self.options.startTime );\n                    }\n                } );\n                self.player.addEventListener( 'volumechange', ( e ) => {\n                    self.getVolume( ( volume ) => {\n                        self.options.volume = volume;\n                    } );\n                    self.fire( 'volumechange', e );\n                } );\n                self.player.addEventListener( 'error', ( e ) => {\n                    self.fire( 'error', e );\n                } );\n            }\n            callback( self.$video );\n        } );\n    }\n\n    init() {\n        const self = this;\n\n        self.playerID = `VideoWorker-${ self.ID }`;\n    }\n\n    loadAPI() {\n        const self = this;\n\n        if ( YoutubeAPIadded && VimeoAPIadded ) {\n            return;\n        }\n\n        let src = '';\n\n        // load Youtube API\n        if ( 'youtube' === self.type && ! YoutubeAPIadded ) {\n            YoutubeAPIadded = 1;\n            src = 'https://www.youtube.com/iframe_api';\n        }\n\n        // load Vimeo API\n        if ( 'vimeo' === self.type && ! VimeoAPIadded ) {\n            VimeoAPIadded = 1;\n\n            // Useful when Vimeo API added using RequireJS https://github.com/nk-o/video-worker/pull/7\n            if ( 'undefined' !== typeof global.Vimeo ) {\n                return;\n            }\n\n            src = 'https://player.vimeo.com/api/player.js';\n        }\n\n        if ( ! src ) {\n            return;\n        }\n\n        // add script in head section\n        let tag = document.createElement( 'script' );\n        let head = document.getElementsByTagName( 'head' )[ 0 ];\n        tag.src = src;\n\n        head.appendChild( tag );\n\n        head = null;\n        tag = null;\n    }\n\n    onAPIready( callback ) {\n        const self = this;\n\n        // Youtube\n        if ( 'youtube' === self.type ) {\n            // Listen for global YT player callback\n            if ( ( 'undefined' === typeof global.YT || 0 === global.YT.loaded ) && ! loadingYoutubePlayer ) {\n                // Prevents Ready event from being called twice\n                loadingYoutubePlayer = 1;\n\n                // Creates deferred so, other players know when to wait.\n                window.onYouTubeIframeAPIReady = function() {\n                    window.onYouTubeIframeAPIReady = null;\n                    loadingYoutubeDefer.resolve( 'done' );\n                    callback();\n                };\n            } else if ( 'object' === typeof global.YT && 1 === global.YT.loaded ) {\n                callback();\n            } else {\n                loadingYoutubeDefer.done( () => {\n                    callback();\n                } );\n            }\n        }\n\n        // Vimeo\n        if ( 'vimeo' === self.type ) {\n            if ( 'undefined' === typeof global.Vimeo && ! loadingVimeoPlayer ) {\n                loadingVimeoPlayer = 1;\n                const vimeoInterval = setInterval( () => {\n                    if ( 'undefined' !== typeof global.Vimeo ) {\n                        clearInterval( vimeoInterval );\n                        loadingVimeoDefer.resolve( 'done' );\n                        callback();\n                    }\n                }, 20 );\n            } else if ( 'undefined' !== typeof global.Vimeo ) {\n                callback();\n            } else {\n                loadingVimeoDefer.done( () => {\n                    callback();\n                } );\n            }\n        }\n\n        // Local\n        if ( 'local' === self.type ) {\n            callback();\n        }\n    }\n}\n"]},"metadata":{},"sourceType":"module"}